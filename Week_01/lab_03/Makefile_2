CC = gcc
CFLAGS = -Wall -Wextra

SRCS = $(wildcard *.c)
OBJS = $(SRCS:.c=.o)
ASMS = $(SRCS:.c=.s)
PREPS = $(SRCS:.c=.i)

all: preprocessor compiler assembler linker run

debug: CFLAGS += -g
debug: all

.PHONY: all debug clean

run: program
	./program

program: $(OBJS)
	$(CC) $(OBJS) -o program

$(OBJS): %.o: %.s
	as $< -o $@

$(ASMS): %.s: %.c
	$(CC) -S $< -o $@

$(PREPS): %.i: %.c
	$(CC) -E $< > $@

preprocessor: $(PREPS)
compiler: $(ASMS)
assembler: $(OBJS)
linker: program

clean:
	rm -f program $(OBJS) $(ASMS) $(PREPS)